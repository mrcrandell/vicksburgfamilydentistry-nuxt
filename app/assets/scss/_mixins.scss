@use "sass:map";
@use "sass:math";
@use "sass:string";
@use "sass:meta";
@use "sass:list";
@use "_functions.scss" as *;
@use "_variables.scss" as *;

// Mobile-first responsive breakpoints
$breakpoints: (
  sm: 576px,
  md: 768px,
  lg: 992px,
  xl: 1200px,
  xxl: 1600px,
) !default;

@mixin bp-sm-phone-landscape {
  @media (min-width: map.get($breakpoints, "sm")) {
    @content;
  }
}

@mixin bp-md-tablet {
  @media (min-width: map.get($breakpoints, "md")) {
    @content;
  }
}

@mixin bp-lg-laptop {
  @media (min-width: map.get($breakpoints, "lg")) {
    @content;
  }
}

@mixin bp-xl-desktop {
  @media (min-width: map.get($breakpoints, "xl")) {
    @content;
  }
}

@mixin bp-xxl-desktop-large {
  @media (min-width: map.get($breakpoints, "xxl")) {
    @content;
  }
}

// Custom sizes
@mixin bp-custom-min($min-width) {
  @media (min-width: ($min-width * 1px)) {
    @content;
  }
}

// Shadows
@mixin shadow-0() {
  box-shadow: none;
}
@mixin shadow-1() {
  box-shadow: 0 rem(1) rem(3) rgba(0, 0, 0, 0.12),
    0 rem(1) rem(2) rgba(0, 0, 0, 0.24);
}
@mixin shadow-2() {
  box-shadow: 0 rem(3) rem(6) rgba(0, 0, 0, 0.16),
    0 rem(3) rem(6) rgba(0, 0, 0, 0.23);
}
@mixin shadow-3() {
  box-shadow: 0 rem(10) rem(20) rgba(0, 0, 0, 0.19),
    0 rem(6) rem(6) rgba(0, 0, 0, 0.23);
}
@mixin shadow-4() {
  box-shadow: 0 rem(14) rem(28) rgba(0, 0, 0, 0.25),
    0 rem(10) rem(10) rgba(0, 0, 0, 0.22);
}
@mixin shadow-5() {
  box-shadow: 0 rem(30) rem(30) 0 rgba(0, 0, 0, 0.25);
}

// Mixins
@mixin hover() {
  &:hover {
    @content;
  }
}

// Transitions
@mixin transition($transition...) {
  @if list.length($transition) == 0 {
    transition: $transition-base;
  } @else {
    transition: $transition;
  }

  @media screen and (prefers-reduced-motion: reduce) {
    transition: none;
  }
}

// Buttons
@mixin button-size($padding-y, $padding-x, $font-size, $border-radius) {
  padding: $padding-y $padding-x;
  font-size: $font-size;
  border-radius: $border-radius;
}

// Font Stuff
// stylelint-disable scss/dimension-no-non-numeric-values

// SCSS RFS mixin
//
// Automated responsive values for font sizes, paddings, margins and much more
//
// Licensed under MIT (https://github.com/twbs/rfs/blob/main/LICENSE)

// Configuration

// Base value
$rfs-base-value: 1.25rem !default;
$rfs-unit: rem !default;

@if $rfs-unit != rem and $rfs-unit != px {
  @error "`#{$rfs-unit}` is not a valid unit for $rfs-unit. Use `px` or `rem`.";
}

// Breakpoint at where values start decreasing if screen width is smaller
$rfs-breakpoint: 1200px !default;
$rfs-breakpoint-unit: px !default;

@if $rfs-breakpoint-unit !=
  px and
  $rfs-breakpoint-unit !=
  em and
  $rfs-breakpoint-unit !=
  rem
{
  @error "`#{$rfs-breakpoint-unit}` is not a valid unit for $rfs-breakpoint-unit. Use `px`, `em` or `rem`.";
}

// Resize values based on screen height and width
$rfs-two-dimensional: false !default;

// Factor of decrease
$rfs-factor: 10 !default;

@if meta.type-of($rfs-factor) != number or $rfs-factor <= 1 {
  @error "`#{$rfs-factor}` is not a valid  $rfs-factor, it must be greater than 1.";
}

// Mode. Possibilities: "min-media-query", "max-media-query"
$rfs-mode: min-media-query !default;

// Generate enable or disable classes. Possibilities: false, "enable" or "disable"
$rfs-class: false !default;

// 1 rem = $rfs-rem-value px
$rfs-rem-value: 16 !default;

// Safari iframe resize bug: https://github.com/twbs/rfs/issues/14
$rfs-safari-iframe-resize-bug-fix: false !default;

// Disable RFS by setting $enable-rfs to false
$enable-rfs: true !default;

// Cache $rfs-base-value unit
$rfs-base-value-unit: math.unit($rfs-base-value);

@function divide($dividend, $divisor, $precision: 10) {
  $sign: 1;
  @if ($dividend > 0 and $divisor > 0) or ($dividend < 0 and $divisor < 0) {
    $sign: 1;
  } @else {
    $sign: -1;
  }
  $dividend: abs($dividend);
  $divisor: abs($divisor);
  @if $dividend == 0 {
    @return 0;
  }
  @if $divisor == 0 {
    @error "Cannot divide by 0";
  }
  $remainder: $dividend;
  $result: 0;
  $factor: 10;
  @while ($remainder > 0 and $precision >= 0) {
    $quotient: 0;
    @while ($remainder >= $divisor) {
      $remainder: $remainder - $divisor;
      $quotient: $quotient + 1;
    }
    $result: $result * 10 + $quotient;
    $factor: $factor * 0.1;
    $remainder: $remainder * 10;
    $precision: $precision - 1;
    @if ($precision < 0 and $remainder >= $divisor * 5) {
      $result: $result + 1;
    }
  }
  $result: $result * $factor * $sign;
  $dividend-unit: math.unit($dividend);
  $divisor-unit: math.unit($divisor);
  $unit-map: (
    "px": 1px,
    "rem": 1rem,
    "em": 1em,
    "%": 1%,
  );
  @if (
    $dividend-unit != $divisor-unit and map.has-key($unit-map, $dividend-unit)
  ) {
    $result: $result * map.get($unit-map, $dividend-unit);
  }
  @return $result;
}

// Remove px-unit from $rfs-base-value for calculations
@if $rfs-base-value-unit == px {
  $rfs-base-value: divide($rfs-base-value, $rfs-base-value * 0 + 1);
} @else if $rfs-base-value-unit == rem {
  $rfs-base-value: divide(
    $rfs-base-value,
    divide($rfs-base-value * 0 + 1, $rfs-rem-value)
  );
}

// Cache $rfs-breakpoint unit to prevent multiple calls
$rfs-breakpoint-unit-cache: math.unit($rfs-breakpoint);

// Remove unit from $rfs-breakpoint for calculations
@if $rfs-breakpoint-unit-cache == px {
  $rfs-breakpoint: divide($rfs-breakpoint, $rfs-breakpoint * 0 + 1);
} @else if
  $rfs-breakpoint-unit-cache ==
  rem or
  $rfs-breakpoint-unit-cache ==
  "em"
{
  $rfs-breakpoint: divide(
    $rfs-breakpoint,
    divide($rfs-breakpoint * 0 + 1, $rfs-rem-value)
  );
}

// Calculate the media query value
$rfs-mq-value: null;
@if $rfs-breakpoint-unit == px {
  $rfs-mq-value: #{$rfs-breakpoint}px;
} @else {
  $rfs-mq-value: #{divide(
      $rfs-breakpoint,
      $rfs-rem-value
    )}#{$rfs-breakpoint-unit};
}

$rfs-mq-property-width: null;
@if $rfs-mode == max-media-query {
  $rfs-mq-property-width: max-width;
} @else {
  $rfs-mq-property-width: min-width;
}

$rfs-mq-property-height: null;
@if $rfs-mode == max-media-query {
  $rfs-mq-property-height: max-height;
} @else {
  $rfs-mq-property-height: min-height;
}

// Internal mixin used to determine which media query needs to be used
@mixin _rfs-media-query {
  @if $rfs-two-dimensional {
    @if $rfs-mode == max-media-query {
      @media (#{$rfs-mq-property-width}: #{$rfs-mq-value}), (#{$rfs-mq-property-height}: #{$rfs-mq-value}) {
        @content;
      }
    } @else {
      @media (#{$rfs-mq-property-width}: #{$rfs-mq-value}) and (#{$rfs-mq-property-height}: #{$rfs-mq-value}) {
        @content;
      }
    }
  } @else {
    @media (#{$rfs-mq-property-width}: #{$rfs-mq-value}) {
      @content;
    }
  }
}

// Internal mixin that adds disable classes to the selector if needed.
@mixin _rfs-rule {
  @if $rfs-class == disable and $rfs-mode == max-media-query {
    // Adding an extra class increases specificity, which prevents the media query to override the property
    &,
    .disable-rfs &,
    &.disable-rfs {
      @content;
    }
  } @else if $rfs-class == enable and $rfs-mode == min-media-query {
    .enable-rfs &,
    &.enable-rfs {
      @content;
    }
  } @else {
    @content;
  }
}

// Internal mixin that adds enable classes to the selector if needed.
@mixin _rfs-media-query-rule {
  @if $rfs-class == enable {
    @if $rfs-mode == min-media-query {
      @content;
    }

    @include _rfs-media-query() {
      .enable-rfs &,
      &.enable-rfs {
        @content;
      }
    }
  } @else {
    @if $rfs-class == disable and $rfs-mode == min-media-query {
      .disable-rfs &,
      &.disable-rfs {
        @content;
      }
    }
    @include _rfs-media-query() {
      @content;
    }
  }
}

// Helper function to get the formatted non-responsive value
@function rfs-value($values) {
  // Convert to list
  @if meta.type-of($values) != list {
    $values: ($values);
  }

  $val: "";

  // Loop over each value and calculate value
  @each $value in $values {
    @if $value == 0 {
      $val: $val + " 0";
    } @else {
      // Cache $value unit
      $unit: false;
      @if meta.type-of($value) == number {
        $unit: math.unit($value);
      }

      @if $unit == px {
        // Convert to rem if needed
        @if $rfs-unit == rem {
          $val: $val + " " + #{divide($value, $value * 0 + $rfs-rem-value)}rem;
        } @else {
          $val: $val + " " + $value;
        }
      } @else if $unit == rem {
        // Convert to px if needed
        @if $rfs-unit == px {
          $val: $val +
            " " +
            #{divide($value, $value * 0 + 1) *
            $rfs-rem-value}px;
        } @else {
          $val: $val + " " + $value;
        }
      } @else {
        // If $value isn't a number (like inherit) or $value has a unit (not px or rem, like 1.5em) or $ is 0, just print the value
        $val: $val + " " + $value;
      }
    }
  }

  // Remove first space
  @return string.unquote(string.slice($val, 2));
}

// Helper function to get the responsive value calculated by RFS
@function rfs-fluid-value($values) {
  // Convert to list
  @if meta.type-of($values) != list {
    $values: ($values);
  }

  $val: "";

  // Loop over each value and calculate value
  @each $value in $values {
    @if $value == 0 {
      $val: $val + " 0";
    } @else {
      // Cache $value unit
      $unit: false;
      @if meta.type-of($value) == number {
        $unit: math.unit($value);
      }

      // If $value isn't a number (like inherit) or $value has a unit (not px or rem, like 1.5em) or $ is 0, just print the value
      @if not $unit or ($unit != px and $unit != rem) {
        $val: $val + " " + $value;
      } @else {
        // Remove unit from $value for calculations
        $unit-divisor: 1;
        @if $unit == px {
          $unit-divisor: 1;
        } @else {
          $unit-divisor: divide(1, $rfs-rem-value);
        }
        $value: divide($value, $value * 0 + $unit-divisor);

        // Only add the media query if the value is greater than the minimum value
        @if abs($value) <= $rfs-base-value or not $enable-rfs {
          @if $rfs-unit == rem {
            $val: $val + " " + #{divide($value, $rfs-rem-value)}rem;
          } @else {
            $val: $val + " " + #{$value}px;
          }
        } @else {
          // Calculate the minimum value
          $value-min: $rfs-base-value +
            divide(abs($value) - $rfs-base-value, $rfs-factor);

          // Calculate difference between $value and the minimum value
          $value-diff: abs($value) - $value-min;

          // Base value formatting
          $min-width: "";
          @if $rfs-unit == rem {
            $min-width: #{divide($value-min, $rfs-rem-value)}rem;
          } @else {
            $min-width: #{$value-min}px;
          }

          // Use negative value if needed
          @if $value < 0 {
            $min-width: -#{$min-width};
          }

          // Use `vmin` if two-dimensional is enabled
          $variable-unit: vw;
          @if $rfs-two-dimensional {
            $variable-unit: vmin;
          }

          // Calculate the variable width between 0 and $rfs-breakpoint
          $variable-width: #{divide(
              $value-diff * 100,
              $rfs-breakpoint
            )}#{$variable-unit};

          // Return the calculated value
          $separator: " + ";
          @if $value < 0 {
            $separator: " - ";
          }
          $val: $val +
            " calc(" +
            $min-width +
            $separator +
            $variable-width +
            ")";
        }
      }
    }
  }

  // Remove first space
  @return string.unquote(string.slice($val, 2));
}

// RFS mixin
@mixin rfs($values, $property: font-size) {
  @if $values != null {
    $val: rfs-value($values);
    $fluid-val: rfs-fluid-value($values);

    // Do not print the media query if responsive & non-responsive values are the same
    @if $val == $fluid-val {
      #{$property}: $val;
    } @else {
      @include _rfs-rule() {
        @if $rfs-mode == max-media-query {
          #{$property}: $val;
        } @else {
          #{$property}: $fluid-val;
        }

        // Include safari iframe resize fix if needed
        @if $rfs-safari-iframe-resize-bug-fix {
          min-width: (0 * 1vw);
        }
      }

      @include _rfs-media-query-rule() {
        @if $rfs-mode == max-media-query {
          #{$property}: $fluid-val;
        } @else {
          #{$property}: $val;
        }
      }
    }
  }
}

// Shorthand helper mixins
@mixin font-size($value) {
  @include rfs($value);
}

@mixin padding($value) {
  @include rfs($value, padding);
}

@mixin padding-top($value) {
  @include rfs($value, padding-top);
}

@mixin padding-right($value) {
  @include rfs($value, padding-right);
}

@mixin padding-bottom($value) {
  @include rfs($value, padding-bottom);
}

@mixin padding-left($value) {
  @include rfs($value, padding-left);
}

@mixin margin($value) {
  @include rfs($value, margin);
}

@mixin margin-top($value) {
  @include rfs($value, margin-top);
}

@mixin margin-right($value) {
  @include rfs($value, margin-right);
}

@mixin margin-bottom($value) {
  @include rfs($value, margin-bottom);
}

@mixin margin-left($value) {
  @include rfs($value, margin-left);
}

// stylelint-disable property-disallowed-list
// Single side border-radius

// Helper function to replace negative values with 0
@function valid-radius($radius) {
  $return: ();
  @each $value in $radius {
    @if meta.type-of($value) == number {
      $return: list.append($return, math.max($value, 0));
    } @else {
      $return: list.append($return, $value);
    }
  }
  @return $return;
}

// scss-docs-start border-radius-mixins
@mixin border-radius($radius: $border-radius, $fallback-border-radius: false) {
  @if $enable-rounded {
    border-radius: valid-radius($radius);
  } @else if $fallback-border-radius != false {
    border-radius: $fallback-border-radius;
  }
}

@mixin border-top-radius($radius: $border-radius) {
  @if $enable-rounded {
    border-top-left-radius: valid-radius($radius);
    border-top-right-radius: valid-radius($radius);
  }
}

@mixin border-end-radius($radius: $border-radius) {
  @if $enable-rounded {
    border-top-right-radius: valid-radius($radius);
    border-bottom-right-radius: valid-radius($radius);
  }
}

@mixin border-bottom-radius($radius: $border-radius) {
  @if $enable-rounded {
    border-bottom-right-radius: valid-radius($radius);
    border-bottom-left-radius: valid-radius($radius);
  }
}

@mixin border-start-radius($radius: $border-radius) {
  @if $enable-rounded {
    border-top-left-radius: valid-radius($radius);
    border-bottom-left-radius: valid-radius($radius);
  }
}

@mixin border-top-start-radius($radius: $border-radius) {
  @if $enable-rounded {
    border-top-left-radius: valid-radius($radius);
  }
}

@mixin border-top-end-radius($radius: $border-radius) {
  @if $enable-rounded {
    border-top-right-radius: valid-radius($radius);
  }
}

@mixin border-bottom-end-radius($radius: $border-radius) {
  @if $enable-rounded {
    border-bottom-right-radius: valid-radius($radius);
  }
}

@mixin border-bottom-start-radius($radius: $border-radius) {
  @if $enable-rounded {
    border-bottom-left-radius: valid-radius($radius);
  }
}

@mixin form-validation-state-selector($state) {
  @if ($state == "valid" or $state == "invalid") {
    $parent-selector: "";
    @if & {
      $parent-selector: "&";
    }
    .was-validated #{$parent-selector}:#{$state},
    #{$parent-selector}.is-#{$state} {
      @content;
    }
  } @else {
    $parent-selector: "";
    @if & {
      $parent-selector: "&";
    }
    #{$parent-selector}.is-#{$state} {
      @content;
    }
  }
}

@mixin form-validation-state(
  $state,
  $color,
  $icon,
  $tooltip-color: color-contrast($color),
  $tooltip-bg-color: rgba($color, $form-feedback-tooltip-opacity),
  $focus-box-shadow: 0 0 $input-btn-focus-blur $input-focus-width
    rgba($color, $input-btn-focus-color-opacity),
  $border-color: $color
) {
  .#{$state}-feedback {
    display: none;
    width: 100%;
    margin-top: $form-feedback-margin-top;
    @include font-size($form-feedback-font-size);
    color: $color;
  }

  .#{$state}-tooltip {
    position: absolute;
    top: 100%;
    z-index: 5;
    display: none;
    max-width: 100%; // Contain to parent when possible
    padding: $form-feedback-tooltip-padding-y $form-feedback-tooltip-padding-x;
    margin-top: 0.1rem;
    @include font-size($form-feedback-tooltip-font-size);
    line-height: $form-feedback-tooltip-line-height;
    color: $tooltip-color;
    background-color: $tooltip-bg-color;
    @include border-radius($form-feedback-tooltip-border-radius);
  }

  @include form-validation-state-selector($state) {
    ~ .#{$state}-feedback,
    ~ .#{$state}-tooltip {
      display: block;
    }
  }

  .form-control {
    @include form-validation-state-selector($state) {
      border-color: $border-color;

      @if $enable-validation-icons {
        padding-right: $input-height-inner;
        background-image: escape-svg($icon);
        background-repeat: no-repeat;
        background-position: right $input-height-inner-quarter center;
        background-size: $input-height-inner-half $input-height-inner-half;
      }

      &:focus {
        border-color: $border-color;
        box-shadow: $focus-box-shadow;
      }
    }
  }

  // stylelint-disable-next-line selector-no-qualifying-type
  textarea.form-control {
    @include form-validation-state-selector($state) {
      @if $enable-validation-icons {
        padding-right: $input-height-inner;
        background-position: top
          $input-height-inner-quarter
          right
          $input-height-inner-quarter;
      }
    }
  }

  .form-select {
    @include form-validation-state-selector($state) {
      border-color: $border-color;

      @if $enable-validation-icons {
        &:not([multiple]):not([size]),
        &:not([multiple])[size="1"] {
          --form-select-bg-icon: #{escape-svg($icon)};
          padding-right: $form-select-feedback-icon-padding-end;
          background-position: $form-select-bg-position,
            $form-select-feedback-icon-position;
          background-size: $form-select-bg-size, $form-select-feedback-icon-size;
        }
      }

      &:focus {
        border-color: $border-color;
        box-shadow: $focus-box-shadow;
      }
    }
  }

  .form-control-color {
    @include form-validation-state-selector($state) {
      @if $enable-validation-icons {
        width: add($form-color-width, $input-height-inner);
      }
    }
  }

  .form-check-input {
    @include form-validation-state-selector($state) {
      border-color: $border-color;

      &:checked {
        background-color: $color;
      }

      &:focus {
        box-shadow: $focus-box-shadow;
      }

      ~ .form-check-label {
        color: $color;
      }
    }
  }
  .form-check-inline .form-check-input {
    ~ .#{$state}-feedback {
      margin-left: 0.5em;
    }
  }

  .input-group {
    > .form-control:not(:focus),
    > .form-select:not(:focus),
    > .form-floating:not(:focus-within) {
      @include form-validation-state-selector($state) {
        @if $state == "valid" {
          z-index: 3;
        } @else if $state == "invalid" {
          z-index: 4;
        }
      }
    }
  }
}
